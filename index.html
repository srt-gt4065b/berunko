<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë² ë£½ì½” ì–‘ë§ - ë§ˆë¼í† ë„ˆë¥¼ ìœ„í•œ ì„ íƒ</title>
    <style>
        /* [ìŠ¤íƒ€ì¼ ì •ì˜ êµ¬ì—­] */
        :root {
            --primary-color: #ff6b00;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --admin-bg: #2c3e50; /* ê´€ë¦¬ì í…Œë§ˆìƒ‰ */
            --admin-accent: #3498db;
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        /* ê³µí†µ í—¤ë” */
        header {
            background-color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
        }

        .hidden { display: none !important; }

        /* ì‡¼í•‘ëª° ë©”ì¸ */
        .product-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            min-height: 200px; /* ë¡œë”© ë©”ì‹œì§€ ê³µê°„ í™•ë³´ */
        }

        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            cursor: pointer;
            text-align: center;
            padding-bottom: 15px;
            position: relative; /* ì‚­ì œ ë²„íŠ¼ ìœ„ì¹˜ìš© */
        }
        .product-card:hover { transform: translateY(-5px); }

        .product-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            background-color: #eee;
        }

        .product-name { font-weight: bold; margin: 10px 0 5px; }
        .product-price { color: var(--primary-color); font-weight: bold; }
        .product-original-price { 
            text-decoration: line-through; 
            color: #999; 
            font-size: 0.9rem; 
            margin-right: 5px; 
        }
        .product-discount-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* ìƒ‰ìƒ ì„ íƒ ë²„íŠ¼ */
        .color-option-btn {
            width: 50px;
            height: 50px;
            border: 3px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .color-option-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .color-option-btn.selected {
            border-color: var(--primary-color);
            border-width: 4px;
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-color);
        }
        
        .color-option-label {
            display: block;
            text-align: center;
            font-size: 0.8rem;
            margin-top: 5px;
            color: #666;
        }

        /* ë²„íŠ¼ ë° ì…ë ¥ í¼ */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 10px;
        }
        .btn:hover { opacity: 0.9; }
        .btn-secondary { background-color: #999; margin-top: 10px; }
        .btn-small { width: auto; padding: 5px 10px; font-size: 0.8rem; margin: 0; }
        .btn-danger { background-color: #e74c3c; color: white; }
        .btn-edit { background-color: #f39c12; color: white; margin-right: 5px;}

        /* ì¼ë°˜ ë·° ìŠ¤íƒ€ì¼ */
        .detail-view, .order-view, .success-view {
            background: white; padding: 20px; border-radius: 10px;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;
        }
        .detail-img { width: 100%; max-width: 300px; display: block; margin: 0 auto 20px; border-radius: 10px; }
        .price-summary { background-color: #fff8f0; padding: 15px; border-radius: 5px; margin: 20px 0; border: 1px solid #ffe0b2; }
        .bank-info { background-color: #e8f4fd; padding: 15px; border-radius: 5px; margin-bottom: 20px; color: #0056b3; font-weight: bold; text-align: center; }

        /* --- [ê´€ë¦¬ì ì „ìš© ìŠ¤íƒ€ì¼] --- */
        .admin-view {
            background-color: white; padding: 20px; border-radius: 10px; border: 2px solid var(--admin-bg);
        }
        .admin-nav {
            display: flex; gap: 10px; margin-bottom: 20px;
        }
        .admin-nav button {
            flex: 1; padding: 10px; border: none; background: #eee; cursor: pointer; border-radius: 5px;
            font-weight: bold;
        }
        .admin-nav button.active {
            background: var(--admin-bg); color: white;
        }

        /* í†µê³„ ëŒ€ì‹œë³´ë“œ */
        .stats-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;
        }
        .stat-card {
            background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #ddd;
        }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: var(--admin-bg); margin: 5px 0; }
        .stat-label { font-size: 0.9rem; color: #666; }

        /* ìƒí’ˆ ê´€ë¦¬ í…Œì´ë¸” */
        .admin-product-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px; border-bottom: 1px solid #eee;
        }
        .admin-product-info { display: flex; align-items: center; gap: 10px; }
        .admin-product-thumb { width: 40px; height: 40px; border-radius: 4px; object-fit: cover; }

        /* ì£¼ë¬¸ ë‚´ì—­ ìŠ¤íƒ€ì¼ */
        .order-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .order-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; color: #666; }
        .status-badge { padding: 3px 8px; border-radius: 10px; font-size: 0.8rem; }
        .status-pending { background: #ffe0b2; color: #e65100; }
        .status-completed { background: #c8e6c9; color: #2e7d32; }

        /* Footer ìŠ¤íƒ€ì¼ ê°œì„  */
        footer { 
            margin-top: 50px; 
            padding: 30px 20px;
            background-color: #f8f8f8;
            border-top: 1px solid #ddd;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .admin-btn {
            background-color: var(--admin-bg);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 15px;
            transition: background-color 0.3s;
        }
        
        .admin-btn:hover {
            background-color: #34495e;
        }
        
        .copyright {
            color: #aaa;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        /* ë¡œë”©/ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .status-msg { text-align: center; width: 100%; padding: 20px; color: #666; }
        .error-msg { color: #e74c3c; font-weight: bold; }

        /* ì¥ë°”êµ¬ë‹ˆ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .cart-floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s;
        }
        .cart-floating-btn:hover {
            transform: scale(1.1);
        }
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }
        .cart-item-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }
        .cart-item-info {
            flex: 1;
        }
        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .cart-item-option {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        .cart-item-price {
            color: var(--primary-color);
            font-weight: bold;
        }
        .cart-qty-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .cart-qty-btn {
            width: 25px;
            height: 25px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        .cart-qty-btn:hover {
            background: #f5f5f5;
        }
        .cart-remove-btn {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }
        .cart-summary {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 20px;
            border-top: 2px solid #eee;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .cart-total-amount {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.5rem;
        }
        .empty-cart {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        .empty-cart-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <header>
        <div style="display: flex; justify-content: space-between; align-items: center; max-width: 800px; margin: 0 auto;">
            <h1 onclick="goHome()" style="margin: 0; cursor: pointer;">ğŸ§¦ ë² ë£½ì½” ì–‘ë§</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div id="firebase-status" style="font-size: 0.8rem; color: #999;" title="Firebase ì—°ê²° ìƒíƒœ">
                    <span id="status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #ffa500; margin-right: 5px;"></span>
                    <span id="status-text">ì—°ê²°ì¤‘...</span>
                </div>
                <div onclick="showCart()" style="position: relative; cursor: pointer; font-size: 1.8rem;">
                    ğŸ›’
                    <span id="cart-badge" class="cart-badge hidden">0</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        
        <div id="main-page">
            <div style="margin-bottom: 40px; text-align: center;">
                <img src="https://placehold.co/800x350/ff6b00/ffffff?text=VERUNCO+RUNNING&font=roboto" 
                     style="width: 100%; max-height: 350px; object-fit: cover; border-radius: 15px; box-shadow: 0 4px 15px rgba(255, 107, 0, 0.2);" 
                     alt="ë©”ì¸ ë°°ë„ˆ">
            </div>

            <h2 style="text-align:center; margin-bottom:30px;" id="main-header-text">ê¸°ë¡ ë‹¨ì¶•ì„ ìœ„í•œ ìµœê³ ì˜ ì„ íƒ</h2>
            
            <div id="product-list" class="product-list">
                <div class="product-card" onclick="showProductDetail('static-1')">
                    <img src="https://placehold.co/300x300/orange/white?text=Speed" class="product-img">
                    <div style="padding:10px;">
                        <div class="product-name">ë² ë£½ì½” ìŠ¤í”¼ë“œ (ì´ˆê²½ëŸ‰)</div>
                        <div class="product-price">12,000ì›</div>
                    </div>
                </div>
                <div class="product-card" onclick="showProductDetail('static-2')">
                    <img src="https://placehold.co/300x300/navy/white?text=Marathon" class="product-img">
                    <div style="padding:10px;">
                        <div class="product-name">ë² ë£½ì½” ë§ˆë¼í†¤ í”„ë¡œ</div>
                        <div class="product-price">15,000ì›</div>
                    </div>
                </div>
                <div class="product-card" onclick="showProductDetail('static-3')">
                    <img src="https://placehold.co/300x300/green/white?text=Recovery" class="product-img">
                    <div style="padding:10px;">
                        <div class="product-name">ë² ë£½ì½” ë¦¬ì»¤ë²„ë¦¬</div>
                        <div class="product-price">18,000ì›</div>
                    </div>
                </div>
                <div class="product-card" onclick="showProductDetail('static-4')">
                    <img src="https://placehold.co/300x300/brown/white?text=Trail" class="product-img">
                    <div style="padding:10px;">
                        <div class="product-name">ë² ë£½ì½” íŠ¸ë ˆì¼</div>
                        <div class="product-price">14,000ì›</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="product-detail-page" class="hidden detail-view">
            <button onclick="goHome()" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">â† ë’¤ë¡œê°€ê¸°</button>
            <div style="text-align: center;">
                <img id="detail-img" class="detail-img" src="" alt="ìƒí’ˆì´ë¯¸ì§€">
                <h2 id="detail-name">ìƒí’ˆëª…</h2>
                <h3 id="detail-price" style="color:var(--primary-color)">0ì›</h3>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            
            <div class="form-group" id="color-selection-group">
                <label>ìƒ‰ìƒ ì„ íƒ</label>
                <div id="color-options" style="display: flex; gap: 10px; flex-wrap: wrap;">
                    </div>
            </div>
            
            <div class="form-group">
                <label>ì‚¬ì´ì¦ˆ ì„ íƒ</label>
                <select id="option-size">
                    <option value="S">S (220-255mm)</option>
                    <option value="M">M (260-275mm)</option>
                    <option value="L">L (280-295mm)</option>
                </select>
            </div>
            <div class="form-group">
                <label>ìˆ˜ëŸ‰</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button type="button" onclick="changeQty(-1)" style="padding: 5px 15px;">-</button>
                    <input type="number" id="order-qty" value="1" readonly style="width: 50px; text-align: center;">
                    <button type="button" onclick="changeQty(1)" style="padding: 5px 15px;">+</button>
                </div>
            </div>
            <div class="price-summary">ì´ ê²°ì œ ê¸ˆì•¡ <span id="total-price-display" class="total-price">0ì›</span></div>
            <button class="btn" onclick="addToCart()">ğŸ›’ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°</button>
            <button class="btn btn-secondary" onclick="buyNow()">ë°”ë¡œ êµ¬ë§¤í•˜ê¸°</button>
        </div>

        <div id="order-form-page" class="hidden order-view">
            <button onclick="showCart()" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">â† ë’¤ë¡œê°€ê¸°</button>
            <h2>ì£¼ë¬¸ì„œ ì‘ì„±</h2>
            <div class="price-summary">
                <div id="summary-product-name"></div>
                <div id="summary-option-legacy" style="display:none;"><strong>ì˜µì…˜:</strong> <span id="summary-option"></span> / <span id="summary-qty"></span>ê°œ</div>
                <hr>
                <p style="text-align: right;">ê²°ì œ ê¸ˆì•¡: <span id="summary-total" style="font-weight:bold; color:var(--primary-color)"></span></p>
            </div>
            <div class="bank-info">ì¹´ì¹´ì˜¤ë±…í¬ 3333-03-1084442 (ê¹€í˜•íƒœ)</div>
            <form id="order-form">
                <div class="form-group"><label>ì£¼ë¬¸ì ì´ë¦„</label><input type="text" id="user-name" required placeholder="í™ê¸¸ë™"></div>
                <div class="form-group"><label>ì—°ë½ì²˜</label><input type="tel" id="user-phone" required placeholder="010-1234-5678"></div>
                <div class="form-group"><label>ë°°ì†¡ ì£¼ì†Œ</label><input type="text" id="user-address" required placeholder="ì„œìš¸ì‹œ ..."></div>
                <div class="form-group"><label>ì…ê¸ˆìëª…</label><input type="text" id="deposit-name" required placeholder="í•„ìˆ˜ ì…ë ¥"></div>
                <button type="submit" class="btn" id="btn-order-submit">ì£¼ë¬¸ ì™„ë£Œí•˜ê¸°</button>
            </form>
        </div>

        <div id="cart-page" class="hidden detail-view">
            <button onclick="goHome()" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">â† ì‡¼í•‘ ê³„ì†í•˜ê¸°</button>
            <h2>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h2>
            
            <div id="cart-items-container">
                </div>

            <div id="empty-cart" class="empty-cart hidden">
                <div class="empty-cart-icon">ğŸ›’</div>
                <p>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</p>
                <button class="btn" onclick="goHome()">ì‡¼í•‘ ì‹œì‘í•˜ê¸°</button>
            </div>

            <div id="cart-summary-section" class="cart-summary hidden">
                <div class="cart-total">
                    <span>ì´ <span id="cart-total-items">0</span>ê°œ ìƒí’ˆ</span>
                    <span class="cart-total-amount" id="cart-total-price">0ì›</span>
                </div>
                <button class="btn" onclick="proceedToCheckout()">ì£¼ë¬¸í•˜ê¸°</button>
            </div>
        </div>

        <div id="success-page" class="hidden success-view" style="text-align: center; padding: 50px 20px;">
            <div style="font-size: 3rem;">âœ…</div>
            <h2>ì£¼ë¬¸ ì„±ê³µ!</h2>
            <p><strong><span id="final-price"></span>ì›</strong>ì„ ì…ê¸ˆí•´ ì£¼ì„¸ìš”.</p>
            <button class="btn btn-secondary" onclick="goHome()">í™ˆìœ¼ë¡œ</button>
        </div>

        <div id="admin-page" class="hidden admin-view">
            <h2>ğŸ‘®â€â™‚ï¸ ê´€ë¦¬ì ëª¨ë“œ</h2>
            
            <div class="admin-nav">
                <button onclick="switchAdminTab('orders')" id="tab-btn-orders" class="active">ì£¼ë¬¸ ê´€ë¦¬</button>
                <button onclick="switchAdminTab('products')" id="tab-btn-products">ìƒí’ˆ ê´€ë¦¬</button>
                <button onclick="switchAdminTab('stats')" id="tab-btn-stats">ë§¤ì¶œ í†µê³„</button>
                <button onclick="switchAdminTab('settings')" id="tab-btn-settings">ì‚¬ì´íŠ¸ ì„¤ì •</button>
            </div>

            <div id="admin-tab-orders">
                <h3>ì‹¤ì‹œê°„ ì£¼ë¬¸ í˜„í™©</h3>
                <div id="admin-order-list">ë¡œë”© ì¤‘...</div>
            </div>

            <div id="admin-tab-products" class="hidden">
                <h3>ìƒí’ˆ ë“±ë¡ ë° ê´€ë¦¬</h3>
                
                <div style="background:#f9f9f9; padding:20px; border-radius:8px; margin-bottom:20px; border:1px solid #ddd;">
                    <h4 style="margin-top:0;" id="product-form-title">ìƒˆ ìƒí’ˆ ë“±ë¡</h4>
                    <form id="add-product-form">
                        <input type="hidden" id="edit-prod-id"> <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <h5 style="margin-top: 0; color: var(--admin-bg);">ğŸ“ ê¸°ë³¸ ì •ë³´</h5>
                            
                            <div class="form-group">
                                <label>ìƒí’ˆëª… *</label>
                                <input type="text" id="new-prod-name" placeholder="ì˜ˆ: ë² ë£½ì½” ìš¸íŠ¸ë¼ ì‚­ìŠ¤" required>
                            </div>
                            
                            <div class="form-group">
                                <label>ìƒí’ˆ ì¹´í…Œê³ ë¦¬</label>
                                <select id="new-prod-category">
                                    <option value="running">ëŸ¬ë‹ìš©</option>
                                    <option value="trail">íŠ¸ë ˆì¼ìš©</option>
                                    <option value="recovery">ë¦¬ì»¤ë²„ë¦¬ìš©</option>
                                    <option value="daily">ì¼ìƒìš©</option>
                                </select>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                                <div class="form-group">
                                    <label>ì •ê°€ (ì›) *</label>
                                    <input type="number" id="new-prod-price" placeholder="15000" required onchange="calculateDiscount()">
                                </div>
                                
                                <div class="form-group">
                                    <label>í• ì¸ìœ¨ (%)</label>
                                    <input type="number" id="new-prod-discount" placeholder="0" min="0" max="100" value="0" onchange="calculateSalePrice()">
                                </div>
                                
                                <div class="form-group">
                                    <label>í• ì¸ê°€ (ì›)</label>
                                    <input type="number" id="new-prod-sale-price" placeholder="ìë™ê³„ì‚°" readonly style="background: #f5f5f5;">
                                </div>
                            </div>
                            
                            <div id="discount-preview" style="display: none; padding: 10px; background: #fff3e0; border-radius: 5px; margin-top: 10px; border-left: 3px solid #ff6b00;">
                                <strong>í• ì¸ ë¯¸ë¦¬ë³´ê¸°:</strong><br>
                                <span style="text-decoration: line-through; color: #999;" id="preview-original-price">15,000ì›</span>
                                <span style="margin-left: 10px; color: var(--primary-color); font-weight: bold; font-size: 1.2rem;" id="preview-sale-price">12,000ì›</span>
                                <span style="margin-left: 5px; background: #e74c3c; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.9rem;" id="preview-discount-badge">20%</span>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <h5 style="margin-top: 0; color: var(--admin-bg);">ğŸ¨ ìƒ‰ìƒë³„ ì¬ê³  ê´€ë¦¬ (ìµœëŒ€ 5ê°€ì§€)</h5>
                            
                            <div id="color-stock-container">
                                <div class="color-stock-item" style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa;">
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                        <input type="text" class="color-name-input" placeholder="ìƒ‰ìƒëª… (ì˜ˆ: ë¸”ë™)" style="flex: 2;" required>
                                        <input type="color" class="color-picker-input" value="#000000" style="width: 50px; height: 35px; border: 1px solid #ddd; border-radius: 5px;">
                                        <button type="button" class="btn btn-small btn-danger" onclick="removeColorStock(this)" style="width: auto; margin: 0;">ì‚­ì œ</button>
                                    </div>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                                        <div>
                                            <label style="font-size: 0.9rem; color: #666;">S (220-240mm)</label>
                                            <input type="number" class="stock-s-input" placeholder="ì¬ê³ " value="50" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                                        </div>
                                        <div>
                                            <label style="font-size: 0.9rem; color: #666;">M (240-270mm)</label>
                                            <input type="number" class="stock-m-input" placeholder="ì¬ê³ " value="100" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                                        </div>
                                        <div>
                                            <label style="font-size: 0.9rem; color: #666;">L (275-290mm)</label>
                                            <input type="number" class="stock-l-input" placeholder="ì¬ê³ " value="50" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                                        </div>
                                    </div>
                                    <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 5px; text-align: center; font-size: 0.9rem;">
                                        <strong>ì´ ìƒ‰ìƒ ì´ ì¬ê³ :</strong> <span class="color-total-stock">200</span>ê°œ
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn btn-small btn-secondary" onclick="addColorStock()" style="width: auto; margin-bottom: 10px;">+ ìƒ‰ìƒ ì¶”ê°€</button>
                            <small style="color:#888; display: block; margin-bottom: 10px;">* ìµœì†Œ 1ê°œ, ìµœëŒ€ 5ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥</small>
                            
                            <div style="padding: 15px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff6b00; margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <strong style="font-size: 1.1rem;">ì „ì²´ ì´ ì¬ê³ :</strong>
                                    <span id="grand-total-stock" style="font-size: 1.3rem; font-weight: bold; color: var(--primary-color);">200</span>ê°œ
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <h5 style="margin-top: 0; color: var(--admin-bg);">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì •ë³´</h5>
                            
                            <div class="form-group">
                                <label>ë©”ì¸ ì´ë¯¸ì§€ URL *</label>
                                <input type="text" id="new-prod-img" placeholder="https://placehold.co/300x300/orange/white?text=Product" required>
                                <small style="color:#888;">
                                    * ë¬´ë£Œ ì´ë¯¸ì§€: <a href="https://placehold.co" target="_blank">placehold.co</a>, 
                                    <a href="https://unsplash.com" target="_blank">unsplash.com</a>
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label>ìƒì„¸ ì´ë¯¸ì§€ URL (ì„ íƒ)</label>
                                <textarea id="new-prod-detail-imgs" rows="3" placeholder="ì´ë¯¸ì§€ URLì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥
https://example.com/detail1.jpg
https://example.com/detail2.jpg"></textarea>
                                <small style="color:#888;">* ìƒì„¸ í˜ì´ì§€ì— ì¶”ê°€ë¡œ í‘œì‹œë  ì´ë¯¸ì§€ë“¤</small>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <h5 style="margin-top: 0; color: var(--admin-bg);">ğŸ“‹ ìƒì„¸ ì„¤ëª…</h5>
                            
                            <div class="form-group">
                                <label>í•œì¤„ ì†Œê°œ</label>
                                <input type="text" id="new-prod-summary" placeholder="ì˜ˆ: ì´ˆê²½ëŸ‰ ë©”ì‹œ ì†Œì¬ë¡œ í†µê¸°ì„±ì´ ë›°ì–´ë‚œ ëŸ¬ë‹ ì–‘ë§">
                            </div>
                            
                            <div class="form-group">
                                <label>ìƒì„¸ ì„¤ëª…</label>
                                <textarea id="new-prod-description" rows="5" placeholder="ìƒí’ˆì˜ íŠ¹ì§•, ì†Œì¬, ì‚¬ìš© ìš©ë„ ë“±ì„ ìì„¸íˆ ì…ë ¥í•˜ì„¸ìš”.

ì˜ˆ:
- ì†Œì¬: í´ë¦¬ì—ìŠ¤í„° 70%, ë‚˜ì¼ë¡  25%, ìŠ¤íŒë±ìŠ¤ 5%
- íŠ¹ì§•: ë©”ì‹œ êµ¬ì¡°ë¡œ í†µê¸°ì„± ìš°ìˆ˜, ì•„ì¹˜ ì„œí¬íŠ¸, ë°œëª© ì¿ ì…˜
- ì¶”ì²œ: 5km ì´ìƒ ì¥ê±°ë¦¬ ëŸ¬ë‹, ë§ˆë¼í†¤ í›ˆë ¨"></textarea>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <h5 style="margin-top: 0; color: var(--admin-bg);">âš™ï¸ ì¶”ê°€ ì˜µì…˜</h5>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="new-prod-bestseller"> 
                                    ë² ìŠ¤íŠ¸ì…€ëŸ¬ í‘œì‹œ
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="new-prod-new"> 
                                    ì‹ ìƒí’ˆ í‘œì‹œ
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>ì œí’ˆ íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                                <input type="text" id="new-prod-tags" placeholder="ì˜ˆ: ê²½ëŸ‰, ë©”ì‹œ, í†µê¸°ì„±, ì—¬ë¦„ìš©">
                                <small style="color:#888;">* ê²€ìƒ‰ ë° í•„í„°ë§ì— ì‚¬ìš©ë©ë‹ˆë‹¤</small>
                            </div>
                        </div>
                        
                        <div style="display:flex; gap:10px;">
                            <button type="submit" class="btn btn-small" id="btn-save-product" style="flex: 1;">âœ… ìƒí’ˆ ì¶”ê°€í•˜ê¸°</button>
                            <button type="button" class="btn btn-small btn-secondary hidden" id="btn-cancel-edit" onclick="cancelEdit()" style="flex: 1;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                </div>

                <h4>ë“±ë¡ëœ ìƒí’ˆ ëª©ë¡</h4>
                <div id="admin-product-list">
                    </div>
            </div>

            <div id="admin-tab-stats" class="hidden">
                <h3>ğŸ“Š ì „ì²´ ë§¤ì¶œ í˜„í™©</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">ì´ ë§¤ì¶œì•¡</div>
                        <div class="stat-value" id="stat-total-revenue">0ì›</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ì´ ì£¼ë¬¸ ê±´ìˆ˜</div>
                        <div class="stat-value" id="stat-total-count">0ê±´</div>
                    </div>
                </div>

                <h4>ë°°ì†¡ ì²˜ë¦¬ í˜„í™©</h4>
                <div class="stats-container" style="margin-bottom:20px;">
                    <div class="stat-card" style="background-color:#fff3e0;">
                        <div class="stat-label">ë°°ì†¡ ëŒ€ê¸°</div>
                        <div class="stat-value" id="stat-pending-count" style="color:#e65100">0ê±´</div>
                    </div>
                    <div class="stat-card" style="background-color:#e8f5e9;">
                        <div class="stat-label">ë°°ì†¡ ì™„ë£Œ</div>
                        <div class="stat-value" id="stat-completed-count" style="color:#2e7d32">0ê±´</div>
                    </div>
                </div>
                
                <h4>ìƒí’ˆë³„ íŒë§¤ëŸ‰</h4>
                <ul id="stat-product-breakdown" style="list-style: none; padding: 0;">
                    </ul>
            </div>

            <div id="admin-tab-settings" class="hidden">
                <h3>âš™ï¸ ì‚¬ì´íŠ¸ ì„¤ì •</h3>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-top: 0;">ë©”ì¸ í˜ì´ì§€ í—¤ë” ë¬¸êµ¬</h4>
                    <form id="site-settings-form">
                        <div class="form-group">
                            <label>ë©”ì¸ í—¤ë” ë¬¸êµ¬</label>
                            <input type="text" id="site-header-text" placeholder="ì˜ˆ: ê¸°ë¡ ë‹¨ì¶•ì„ ìœ„í•œ ìµœê³ ì˜ ì„ íƒ" style="font-size: 1.1rem;">
                            <small style="color:#888;">* ë©”ì¸ í˜ì´ì§€ ìƒë‹¨ì— í‘œì‹œë˜ëŠ” ìºì¹˜í”„ë ˆì´ì¦ˆì…ë‹ˆë‹¤</small>
                        </div>
                        
                        <div style="padding: 15px; background: #f0f8ff; border-radius: 5px; margin: 15px 0; border-left: 3px solid #3498db;">
                            <strong>ë¯¸ë¦¬ë³´ê¸°:</strong><br>
                            <div style="text-align: center; margin-top: 10px; font-size: 1.2rem; font-weight: bold;" id="header-preview">
                                ê¸°ë¡ ë‹¨ì¶•ì„ ìœ„í•œ ìµœê³ ì˜ ì„ íƒ
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-small" style="width: auto;">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                    </form>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-top: 0;">í˜„ì¬ ì„¤ì • ì •ë³´</h4>
                    <div style="padding: 10px; background: #fafafa; border-radius: 5px;">
                        <p><strong>ì‚¬ì´íŠ¸ëª…:</strong> ë² ë£½ì½” ì–‘ë§</p>
                        <p><strong>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</strong> <span id="last-updated">-</span></p>
                    </div>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="goHome()" style="margin-top:20px;">ì‡¼í•‘ëª°ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

    </div>

    <footer>
        <div class="footer-content">
            <button class="admin-btn" onclick="goToAdmin()">ğŸ” ê´€ë¦¬ì ëª¨ë“œ</button>
            <div class="copyright">Â© 2024 Verunco Socks Corp.</div>
        </div>
    </footer>

    <script>
        // [ìˆ˜ì •1] ì „ì—­ ë³€ìˆ˜ë“¤ì„ ìŠ¤í¬ë¦½íŠ¸ ìµœìƒë‹¨ì— ì„ ì–¸
        const defaultProducts = [
            { id: 'static-1', name: "ë² ë£½ì½” ìŠ¤í”¼ë“œ (ì´ˆê²½ëŸ‰)", price: 12000, img: "https://placehold.co/300x300/orange/white?text=Speed" },
            { id: 'static-2', name: "ë² ë£½ì½” ë§ˆë¼í†¤ í”„ë¡œ", price: 15000, img: "https://placehold.co/300x300/navy/white?text=Marathon" },
            { id: 'static-3', name: "ë² ë£½ì½” ë¦¬ì»¤ë²„ë¦¬", price: 18000, img: "https://placehold.co/300x300/green/white?text=Recovery" },
            { id: 'static-4', name: "ë² ë£½ì½” íŠ¸ë ˆì¼", price: 14000, img: "https://placehold.co/300x300/brown/white?text=Trail" }
        ];

        window.products = [...defaultProducts]; // [ì¤‘ìš”] ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“ˆì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•¨
        window.selectedProduct = null;
        window.currentQty = 1;
        window.allOrders = [];
        window.cart = []; // ì¥ë°”êµ¬ë‹ˆ ë°°ì—´
        window.selectedColor = ''; // ì„ íƒëœ ìƒ‰ìƒ

        // [ìˆ˜ì •2] í•µì‹¬ UI í•¨ìˆ˜ë“¤ì„ ì¦‰ì‹œ ì „ì—­ìœ¼ë¡œ ì •ì˜ (windowì— ì§ì ‘ í• ë‹¹)
        window.switchView = function(viewId) {
            ['main-page', 'product-detail-page', 'cart-page', 'order-form-page', 'success-page', 'admin-page'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
            window.scrollTo(0, 0);
        };

        window.goHome = function() { 
            window.selectedProduct = null; 
            window.switchView('main-page'); 
        };
        
        window.showProductDetail = function(id) {
            console.log('showProductDetail í˜¸ì¶œ:', id, 'products:', window.products);
            window.selectedProduct = window.products.find(p => p.id === id);
            if(!window.selectedProduct) {
                console.error('ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', id);
                return;
            }
            window.currentQty = 1;
            
            // í• ì¸ìœ¨ ê³„ì‚°
            const p = window.selectedProduct;
            const discount = p.salePrice && p.price > p.salePrice ? 
                            Math.round((1 - p.salePrice / p.price) * 100) : 0;
            const displayPrice = p.salePrice || p.price;
            
            document.getElementById('detail-img').src = p.img;
            document.getElementById('detail-name').innerText = p.name;
            
            // ê°€ê²© í‘œì‹œ (í• ì¸ ì •ë³´ í¬í•¨)
            const priceHTML = discount > 0 ? 
                `<span class="product-original-price" style="font-size: 1rem;">${Number(p.price).toLocaleString()}ì›</span><br>
                 <span class="product-price" style="font-size: 1.8rem;">${Number(displayPrice).toLocaleString()}ì›</span>
                 <span class="product-discount-badge" style="font-size: 1rem; padding: 4px 10px;">${discount}%</span>` :
                `<span class="product-price" style="font-size: 1.8rem;">${Number(displayPrice).toLocaleString()}ì›</span>`;
            
            document.getElementById('detail-price').innerHTML = priceHTML;
            
            // ìƒ‰ìƒ ì˜µì…˜ ë Œë”ë§
            const colorContainer = document.getElementById('color-options');
            if (colorContainer) {
                colorContainer.innerHTML = '';
                
                if (p.colorStocks && p.colorStocks.length > 0) {
                    p.colorStocks.forEach((colorStock, index) => {
                        const colorBtn = document.createElement('div');
                        colorBtn.style.textAlign = 'center';
                        colorBtn.innerHTML = `
                            <button 
                                class="color-option-btn ${index === 0 ? 'selected' : ''}" 
                                style="background-color: ${colorStock.code};"
                                onclick="selectColor('${colorStock.name}', this)"
                                data-color="${colorStock.name}">
                            </button>
                            <span class="color-option-label">${colorStock.name}</span>
                        `;
                        colorContainer.appendChild(colorBtn);
                    });
                    window.selectedColor = p.colorStocks[0].name;
                } else {
                    colorContainer.innerHTML = '<p style="color: #999; font-size: 0.9rem;">ìƒ‰ìƒ ì˜µì…˜ ì—†ìŒ</p>';
                    window.selectedColor = '';
                }
            }
            
            document.getElementById('order-qty').value = window.currentQty;
            window.updateTotalPrice();
            window.switchView('product-detail-page');
        };


        window.selectColor = function(colorName, btnElement) {
            window.selectedColor = colorName;
            document.querySelectorAll('.color-option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            btnElement.classList.add('selected');
        };

        window.changeQty = function(change) {
            window.currentQty += change;
            if (window.currentQty < 1) window.currentQty = 1;
            document.getElementById('order-qty').value = window.currentQty;
            window.updateTotalPrice();
        };

        window.updateTotalPrice = function() {
            if (!window.selectedProduct) return;
            const displayPrice = window.selectedProduct.salePrice || window.selectedProduct.price;
            const total = displayPrice * window.currentQty;
            document.getElementById('total-price-display').innerText = total.toLocaleString() + "ì›";
        };

        window.goToOrderForm = function() {
            // (ì‚¬ìš© ì•ˆí•¨ - ì¥ë°”êµ¬ë‹ˆ ê±°ì³ì„œ ì´ë™)
            window.switchView('order-form-page');
        };

        window.goBackToDetail = function() { 
            window.switchView('product-detail-page'); 
        };
        
        // [ìˆ˜ì •ë¨] ê´€ë¦¬ì ëª¨ë“œ ë¹„ë°€ë²ˆí˜¸ ì¶”ê°€
        window.goToAdmin = function() { 
            const password = prompt("ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (password === "1230") {
                window.switchView('admin-page');
            } else if (password !== null) {
                alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!");
            }
        };

        // ===== ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ =====
        
        window.updateCartUI = function() {
            const badge = document.getElementById('cart-badge');
            const totalItems = window.cart.reduce((sum, item) => sum + item.qty, 0);
            
            if (totalItems > 0) {
                badge.textContent = totalItems;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
            
            // localStorageì— ì €ì¥
            localStorage.setItem('berunko_cart', JSON.stringify(window.cart));
        };

        window.addToCart = function() {
            if (!window.selectedProduct) return;
            
            const size = document.getElementById('option-size').value;
            const qty = window.currentQty;
            const displayPrice = window.selectedProduct.salePrice || window.selectedProduct.price;
            const color = window.selectedColor || 'ìƒ‰ìƒ ë¯¸ì„ íƒ';
            
            // ê°™ì€ ìƒí’ˆ, ê°™ì€ ìƒ‰ìƒ, ê°™ì€ ì‚¬ì´ì¦ˆê°€ ìˆëŠ”ì§€ í™•ì¸
            const existingIndex = window.cart.findIndex(item => 
                item.id === window.selectedProduct.id && item.option === size && item.color === color
            );
            
            if (existingIndex >= 0) {
                // ì´ë¯¸ ìˆìœ¼ë©´ ìˆ˜ëŸ‰ë§Œ ì¦ê°€
                window.cart[existingIndex].qty += qty;
                alert('ì¥ë°”êµ¬ë‹ˆì— ìˆ˜ëŸ‰ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
                // ìƒˆ ì•„ì´í…œ ì¶”ê°€
                window.cart.push({
                    id: window.selectedProduct.id,
                    name: window.selectedProduct.name,
                    price: displayPrice,  // í• ì¸ê°€ ì ìš©
                    img: window.selectedProduct.img,
                    color: color,
                    option: size,
                    qty: qty
                });
                alert('ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤!');
            }
            
            window.updateCartUI();
        };

        window.buyNow = function() {
            if (!window.selectedProduct) return;
            const size = document.getElementById('option-size').value;
            const qty = window.currentQty;
            const displayPrice = window.selectedProduct.salePrice || window.selectedProduct.price;
            const color = window.selectedColor || 'ìƒ‰ìƒ ë¯¸ì„ íƒ';
            
            // ì„ì‹œ ì¥ë°”êµ¬ë‹ˆë¡œ ì„¤ì •
            window.cart = [{
                id: window.selectedProduct.id,
                name: window.selectedProduct.name,
                price: displayPrice,  // í• ì¸ê°€ ì ìš©
                img: window.selectedProduct.img,
                color: color,
                option: size,
                qty: qty
            }];
            
            window.proceedToCheckout();
        };

        window.showCart = function() {
            const container = document.getElementById('cart-items-container');
            const emptyCart = document.getElementById('empty-cart');
            const summarySection = document.getElementById('cart-summary-section');
            
            if (window.cart.length === 0) {
                container.innerHTML = '';
                emptyCart.classList.remove('hidden');
                summarySection.classList.add('hidden');
            } else {
                emptyCart.classList.add('hidden');
                summarySection.classList.remove('hidden');
                
                // ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ ë Œë”ë§
                container.innerHTML = window.cart.map((item, index) => `
                    <div class="cart-item">
                        <img src="${item.img}" class="cart-item-img" onerror="this.src='https://placehold.co/80?text=No+Image'">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            ${item.color ? `<div class="cart-item-option">ìƒ‰ìƒ: ${item.color}</div>` : ''}
                            <div class="cart-item-option">ì‚¬ì´ì¦ˆ: ${item.option}</div>
                            <div class="cart-item-price">${(item.price * item.qty).toLocaleString()}ì›</div>
                        </div>
                        <div class="cart-qty-control">
                            <button class="cart-qty-btn" onclick="updateCartQty(${index}, -1)">-</button>
                            <span style="min-width: 30px; text-align: center;">${item.qty}</span>
                            <button class="cart-qty-btn" onclick="updateCartQty(${index}, 1)">+</button>
                        </div>
                        <button class="cart-remove-btn" onclick="removeFromCart(${index})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                    </div>
                `).join('');
                
                // ì´ ê¸ˆì•¡ ê³„ì‚°
                const totalItems = window.cart.reduce((sum, item) => sum + item.qty, 0);
                const totalPrice = window.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
                
                document.getElementById('cart-total-items').textContent = totalItems;
                document.getElementById('cart-total-price').textContent = totalPrice.toLocaleString() + 'ì›';
            }
            
            window.switchView('cart-page');
        };

        window.updateCartQty = function(index, change) {
            window.cart[index].qty += change;
            
            if (window.cart[index].qty <= 0) {
                if (confirm('ì´ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    window.cart.splice(index, 1);
                } else {
                    window.cart[index].qty = 1;
                }
            }
            
            window.updateCartUI();
            window.showCart(); // í™”ë©´ ê°±ì‹ 
        };

        window.removeFromCart = function(index) {
            if (confirm('ì´ ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.cart.splice(index, 1);
                window.updateCartUI();
                window.showCart(); // í™”ë©´ ê°±ì‹ 
            }
        };

        window.proceedToCheckout = function() {
            if (window.cart.length === 0) {
                alert('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì£¼ë¬¸ ìš”ì•½ ì •ë³´ í‘œì‹œ
            const summaryHtml = window.cart.map(item => 
                `<p><strong>${item.name}</strong> (${item.option}) x ${item.qty}ê°œ = ${(item.price * item.qty).toLocaleString()}ì›</p>`
            ).join('');
            
            const totalPrice = window.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
            
            document.getElementById('summary-product-name').innerHTML = summaryHtml;
            document.getElementById('summary-option').innerHTML = ''; 
            document.getElementById('summary-qty').innerHTML = ''; 
            document.getElementById('summary-total').textContent = totalPrice.toLocaleString() + 'ì›';
            
            window.switchView('order-form-page');
        };

        window.loadCartFromStorage = function() {
            const saved = localStorage.getItem('berunko_cart');
            if (saved) {
                try {
                    window.cart = JSON.parse(saved);
                    window.updateCartUI();
                } catch (e) {
                    console.error('ì¥ë°”êµ¬ë‹ˆ ë¡œë“œ ì‹¤íŒ¨:', e);
                    window.cart = [];
                }
            }
        };

        window.loadCartFromStorage();

        // ===== í• ì¸ê°€ ìë™ ê³„ì‚° í•¨ìˆ˜ =====
        
        window.calculateSalePrice = function() {
            const price = parseInt(document.getElementById('new-prod-price').value) || 0;
            const discount = parseInt(document.getElementById('new-prod-discount').value) || 0;
            
            if (price > 0 && discount > 0) {
                const salePrice = Math.round(price * (100 - discount) / 100);
                document.getElementById('new-prod-sale-price').value = salePrice;
                
                document.getElementById('preview-original-price').textContent = price.toLocaleString() + 'ì›';
                document.getElementById('preview-sale-price').textContent = salePrice.toLocaleString() + 'ì›';
                document.getElementById('preview-discount-badge').textContent = discount + '%';
                document.getElementById('discount-preview').style.display = 'block';
            } else {
                document.getElementById('new-prod-sale-price').value = '';
                document.getElementById('discount-preview').style.display = 'none';
            }
        };
        
        window.calculateDiscount = function() {
            const price = parseInt(document.getElementById('new-prod-price').value) || 0;
            const salePrice = parseInt(document.getElementById('new-prod-sale-price').value) || 0;
            
            if (price > 0 && salePrice > 0 && salePrice < price) {
                const discount = Math.round((1 - salePrice / price) * 100);
                document.getElementById('new-prod-discount').value = discount;
                window.calculateSalePrice();
            }
        };

        // ===== ìƒ‰ìƒë³„ ì¬ê³  ê´€ë¦¬ í•¨ìˆ˜ =====
        
        window.addColorStock = function() {
            const container = document.getElementById('color-stock-container');
            const colorItems = container.querySelectorAll('.color-stock-item');
            
            if (colorItems.length >= 5) {
                alert('ìƒ‰ìƒì€ ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            const newItem = document.createElement('div');
            newItem.className = 'color-stock-item';
            newItem.style.cssText = 'border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa;';
            newItem.innerHTML = `
                <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                    <input type="text" class="color-name-input" placeholder="ìƒ‰ìƒëª… (ì˜ˆ: í™”ì´íŠ¸)" style="flex: 2;" required>
                    <input type="color" class="color-picker-input" value="#ffffff" style="width: 50px; height: 35px; border: 1px solid #ddd; border-radius: 5px;">
                    <button type="button" class="btn btn-small btn-danger" onclick="removeColorStock(this)" style="width: auto; margin: 0;">ì‚­ì œ</button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">S (220-240mm)</label>
                        <input type="number" class="stock-s-input" placeholder="ì¬ê³ " value="50" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                    </div>
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">M (240-270mm)</label>
                        <input type="number" class="stock-m-input" placeholder="ì¬ê³ " value="100" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                    </div>
                    <div>
                        <label style="font-size: 0.9rem; color: #666;">L (275-290mm)</label>
                        <input type="number" class="stock-l-input" placeholder="ì¬ê³ " value="50" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 5px; text-align: center; font-size: 0.9rem;">
                    <strong>ì´ ìƒ‰ìƒ ì´ ì¬ê³ :</strong> <span class="color-total-stock">200</span>ê°œ
                </div>
            `;
            container.appendChild(newItem);
            window.updateAllStocks();
        };
        
        window.removeColorStock = function(btn) {
            const container = document.getElementById('color-stock-container');
            const colorItems = container.querySelectorAll('.color-stock-item');
            
            if (colorItems.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ìƒ‰ìƒì€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            btn.closest('.color-stock-item').remove();
            window.updateAllStocks();
        };
        
        window.updateAllStocks = function() {
            const colorItems = document.querySelectorAll('.color-stock-item');
            let grandTotal = 0;
            
            colorItems.forEach(item => {
                const stockS = parseInt(item.querySelector('.stock-s-input').value) || 0;
                const stockM = parseInt(item.querySelector('.stock-m-input').value) || 0;
                const stockL = parseInt(item.querySelector('.stock-l-input').value) || 0;
                const colorTotal = stockS + stockM + stockL;
                
                const colorTotalDisplay = item.querySelector('.color-total-stock');
                if (colorTotalDisplay) {
                    colorTotalDisplay.textContent = colorTotal;
                }
                
                grandTotal += colorTotal;
            });
            
            const grandTotalDisplay = document.getElementById('grand-total-stock');
            if (grandTotalDisplay) {
                grandTotalDisplay.textContent = grandTotal;
            }
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            window.updateAllStocks();
        });

        window.switchAdminTab = function(tabName) {
            ['orders', 'products', 'stats', 'settings'].forEach(t => {
                document.getElementById(`tab-btn-${t}`).classList.remove('active');
                document.getElementById(`admin-tab-${t}`).classList.add('hidden');
            });
            document.getElementById(`tab-btn-${tabName}`).classList.add('active');
            document.getElementById(`admin-tab-${tabName}`).classList.remove('hidden');
        };

        window.editProduct = function(id) {
            const p = window.products.find(prod => prod.id === id);
            if (!p) return;

            document.getElementById('product-form-title').innerText = "ìƒí’ˆ ìˆ˜ì • ëª¨ë“œ";
            document.getElementById('edit-prod-id').value = id;
            
            document.getElementById('new-prod-name').value = p.name || '';
            document.getElementById('new-prod-price').value = p.price || '';
            document.getElementById('new-prod-discount').value = p.discount || 0;
            document.getElementById('new-prod-sale-price').value = p.salePrice || '';
            document.getElementById('new-prod-category').value = p.category || 'running';
            
            if (p.discount > 0) {
                window.calculateSalePrice();
            }
            
            const colorContainer = document.getElementById('color-stock-container');
            colorContainer.innerHTML = ''; 
            
            if (p.colorStocks && p.colorStocks.length > 0) {
                p.colorStocks.forEach(colorStock => {
                    const newItem = document.createElement('div');
                    newItem.className = 'color-stock-item';
                    newItem.style.cssText = 'border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa;';
                    newItem.innerHTML = `
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                            <input type="text" class="color-name-input" placeholder="ìƒ‰ìƒëª…" value="${colorStock.name}" style="flex: 2;" required>
                            <input type="color" class="color-picker-input" value="${colorStock.code}" style="width: 50px; height: 35px; border: 1px solid #ddd; border-radius: 5px;">
                            <button type="button" class="btn btn-small btn-danger" onclick="removeColorStock(this)" style="width: auto; margin: 0;">ì‚­ì œ</button>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                            <div>
                                <label style="font-size: 0.9rem; color: #666;">S (220-240mm)</label>
                                <input type="number" class="stock-s-input" placeholder="ì¬ê³ " value="${colorStock.stock.S}" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                            </div>
                            <div>
                                <label style="font-size: 0.9rem; color: #666;">M (240-270mm)</label>
                                <input type="number" class="stock-m-input" placeholder="ì¬ê³ " value="${colorStock.stock.M}" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                            </div>
                            <div>
                                <label style="font-size: 0.9rem; color: #666;">L (275-290mm)</label>
                                <input type="number" class="stock-l-input" placeholder="ì¬ê³ " value="${colorStock.stock.L}" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 5px; text-align: center; font-size: 0.9rem;">
                            <strong>ì´ ìƒ‰ìƒ ì´ ì¬ê³ :</strong> <span class="color-total-stock">${colorStock.total}</span>ê°œ
                        </div>
                    `;
                    colorContainer.appendChild(newItem);
                });
            } else {
                window.addColorStock();
            }
            
            window.updateAllStocks();
            
            document.getElementById('new-prod-img').value = p.img || '';
            document.getElementById('new-prod-detail-imgs').value = p.detailImgs ? p.detailImgs.join('\n') : '';
            document.getElementById('new-prod-summary').value = p.summary || '';
            document.getElementById('new-prod-description').value = p.description || '';
            
            document.getElementById('new-prod-bestseller').checked = p.isBestseller || false;
            document.getElementById('new-prod-new').checked = p.isNew || false;
            document.getElementById('new-prod-tags').value = p.tags ? p.tags.join(', ') : '';
            
            document.getElementById('btn-save-product').innerText = "ğŸ’¾ ìˆ˜ì •ì‚¬í•­ ì €ì¥";
            document.getElementById('btn-cancel-edit').classList.remove('hidden');
            
            document.getElementById('add-product-form').scrollIntoView({ behavior: 'smooth' });
        };

        window.cancelEdit = function() {
            document.getElementById('product-form-title').innerText = "ìƒˆ ìƒí’ˆ ë“±ë¡";
            document.getElementById('edit-prod-id').value = "";
            document.getElementById('add-product-form').reset();
            
            const colorContainer = document.getElementById('color-stock-container');
            colorContainer.innerHTML = `
                <div class="color-stock-item" style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fafafa;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                        <input type="text" class="color-name-input" placeholder="ìƒ‰ìƒëª… (ì˜ˆ: ë¸”ë™)" style="flex: 2;" required>
                        <input type="color" class="color-picker-input" value="#000000" style="width: 50px; height: 35px; border: 1px solid #ddd; border-radius: 5px;">
                        <button type="button" class="btn btn-small btn-danger" onclick="removeColorStock(this)" style="width: auto; margin: 0;">ì‚­ì œ</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                        <div>
                            <label style="font-size: 0.9rem; color: #666;">S (220-240mm)</label>
                            <input type="number" class="stock-s-input" placeholder="ì¬ê³ " value="50" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                        </div>
                        <div>
                            <label style="font-size: 0.9rem; color: #666;">M (240-270mm)</label>
                            <input type="number" class="stock-m-input" placeholder="ì¬ê³ " value="100" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                        </div>
                        <div>
                            <label style="font-size: 0.9rem; color: #666;">L (275-290mm)</label>
                            <input type="number" class="stock-l-input" placeholder="ì¬ê³ " value="50" min="0" style="width: 100%; text-align: center;" onchange="updateAllStocks()">
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 5px; text-align: center; font-size: 0.9rem;">
                        <strong>ì´ ìƒ‰ìƒ ì´ ì¬ê³ :</strong> <span class="color-total-stock">200</span>ê°œ
                    </div>
                </div>
            `;
            
            window.updateAllStocks();
            
            document.getElementById('btn-save-product').innerText = "âœ… ìƒí’ˆ ì¶”ê°€í•˜ê¸°";
            document.getElementById('btn-cancel-edit').classList.add('hidden');
        };
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // [ìˆ˜ì •3] setDoc ì¶”ê°€ (ì„¤ì • ì €ì¥ ë° ìƒí’ˆ ì—…ë°ì´íŠ¸ìš©)
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, deleteDoc, serverTimestamp, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 1. Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "AIzaSyDHC0F79_7jnC-YwV48Tiusg0NMHdtPhj4",
            authDomain: "berunko-5c8bf.firebaseapp.com",
            projectId: "berunko-5c8bf",
            storageBucket: "berunko-5c8bf.firebasestorage.app",
            messagingSenderId: "933523639470",
            appId: "1:933523639470:web:33967d8bc13e284a80f13f"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        // 2. ì¸ì¦ ë° ë¦¬ìŠ¤ë„ˆ ì‹œì‘
        async function initAuth() {
            const statusText = document.getElementById('status-text');
            try { 
                if (statusText) statusText.textContent = 'ì¸ì¦ ì¤‘...';
                await signInAnonymously(auth); 
                console.log("Firebase ìµëª… ì¸ì¦ ì„±ê³µ");
            } 
            catch (e) { 
                console.error("ì¸ì¦ ì‹¤íŒ¨:", e);
                if (statusText) {
                    statusText.textContent = 'ì¸ì¦ ì‹¤íŒ¨';
                    statusText.style.color = '#e74c3c';
                }
                alert("Firebase ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
            }
        }
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                console.log("Firebase ì¸ì¦ ì™„ë£Œ:", user.uid);
                
                const statusDot = document.getElementById('status-dot');
                const statusText = document.getElementById('status-text');
                if (statusDot && statusText) {
                    statusDot.style.background = '#4caf50';
                    statusText.textContent = 'ì—°ê²°ë¨';
                    statusText.style.color = '#4caf50';
                    
                    setTimeout(() => {
                        const firebaseStatus = document.getElementById('firebase-status');
                        if (firebaseStatus) {
                            firebaseStatus.style.opacity = '0';
                            firebaseStatus.style.transition = 'opacity 0.5s';
                        }
                    }, 3000);
                }
                
                setupProductListener(); 
                setupOrderListener();
                loadSiteSettings(); 
            } else {
                const statusDot = document.getElementById('status-dot');
                const statusText = document.getElementById('status-text');
                if (statusDot && statusText) {
                    statusDot.style.background = '#e74c3c';
                    statusText.textContent = 'ì—°ê²° ì‹¤íŒ¨';
                    statusText.style.color = '#e74c3c';
                }
            }
        });
        initAuth();

        // [ê¸°ëŠ¥ 1] ìƒí’ˆ ë°ì´í„° ì‹¤ì‹œê°„ ë™ê¸°í™”
        function setupProductListener() {
            const listContainer = document.getElementById('product-list');
            const adminListContainer = document.getElementById('admin-product-list');

            try {
                const productCollection = collection(db, 'products');
                
                onSnapshot(productCollection, (snapshot) => {
                    if (snapshot.empty) {
                        // DBê°€ ë¹„ì–´ìˆìœ¼ë©´ ì´ˆê¸° ë°ì´í„° ì‹œë”© (ì´ ë¶€ë¶„ì€ ì„ íƒ ì‚¬í•­)
                        return; 
                    }

                    let tempProducts = [];
                    snapshot.forEach(docSnap => {
                        tempProducts.push({ id: docSnap.id, ...docSnap.data() });
                    });
                    
                    tempProducts.sort((a, b) => {
                        const timeA = a.createdAt ? a.createdAt.seconds : 0;
                        const timeB = b.createdAt ? b.createdAt.seconds : 0;
                        return timeB - timeA;
                    });
                    
                    // [ì¤‘ìš”] ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                    window.products = tempProducts;

                    listContainer.innerHTML = "";
                    adminListContainer.innerHTML = "";

                    window.products.forEach(p => {
                        const discount = p.salePrice && p.price > p.salePrice ? 
                                                Math.round((1 - p.salePrice / p.price) * 100) : 0;
                        const displayPrice = p.salePrice || p.price;
                        
                        // 1. ë©”ì¸ í™”ë©´ ì¹´ë“œ
                        const card = document.createElement('div');
                        card.className = 'product-card';
                        card.onclick = () => window.showProductDetail(p.id); // window í•¨ìˆ˜ í˜¸ì¶œ
                        card.innerHTML = `
                            <img src="${p.img}" class="product-img" onerror="this.src='https://placehold.co/300?text=No+Image'">
                            <div style="padding:10px;">
                                <div class="product-name">${p.name}</div>
                                <div>
                                    ${discount > 0 ? `<span class="product-original-price">${Number(p.price).toLocaleString()}ì›</span>` : ''}
                                    <span class="product-price">${Number(displayPrice).toLocaleString()}ì›</span>
                                    ${discount > 0 ? `<span class="product-discount-badge">${discount}%</span>` : ''}
                                </div>
                            </div>
                        `;
                        listContainer.appendChild(card);

                        // 2. ê´€ë¦¬ì í™”ë©´ ë¦¬ìŠ¤íŠ¸
                        const adminItem = document.createElement('div');
                        adminItem.className = 'admin-product-item';
                        adminItem.innerHTML = `
                            <div class="admin-product-info">
                                <img src="${p.img}" class="admin-product-thumb">
                                <div>
                                    <strong>${p.name}</strong><br>
                                    ${Number(p.price).toLocaleString()}ì›
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-small btn-edit" onclick="editProduct('${p.id}')">ìˆ˜ì •</button>
                                <button class="btn btn-small btn-danger" onclick="deleteProduct('${p.id}')">ì‚­ì œ</button>
                            </div>
                        `;
                        adminListContainer.appendChild(adminItem);
                    });
                }, (error) => {
                    console.error("ë°ì´í„° ì½ê¸° ê¶Œí•œ/ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:", error);
                });
            } catch (err) {
                console.error("ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘ ì˜¤ë¥˜:", err);
            }
        }

        async function seedInitialProducts() {
            // (ì´ˆê¸° ë°ì´í„° ì‹œë”© ë¡œì§ - ìƒëµ ê°€ëŠ¥í•˜ì§€ë§Œ ìœ ì§€)
            // ... (ê¸°ì¡´ ì‹œë”© ì½”ë“œì™€ ë™ì¼)
        }

        // [ê¸°ëŠ¥ 2] ì£¼ë¬¸ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ
        function setupOrderListener() {
            const orderCollection = collection(db, 'orders');

            onSnapshot(orderCollection, (snapshot) => {
                const listContainer = document.getElementById('admin-order-list');
                window.allOrders = []; // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                let html = "";

                if (snapshot.empty) {
                    listContainer.innerHTML = "<div class='status-msg'>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
                    return;
                }

                snapshot.forEach((docSnap) => {
                    window.allOrders.push({ id: docSnap.id, ...docSnap.data() });
                });

                window.allOrders.sort((a, b) => {
                    const timeA = a.orderDate ? a.orderDate.seconds : 0;
                    const timeB = b.orderDate ? b.orderDate.seconds : 0;
                    return timeB - timeA;
                });

                window.allOrders.forEach((data) => {
                    const date = data.orderDate ? new Date(data.orderDate.seconds * 1000).toLocaleString() : "ë°©ê¸ˆ ì „";
                    const statusClass = data.status === 'ë°°ì†¡ì™„ë£Œ' ? 'status-completed' : 'status-pending';
                    
                    html += `
                        <div class="order-item">
                            <div class="order-header">
                                <span>${date}</span>
                                <span class="status-badge ${statusClass}">${data.status}</span>
                            </div>
                            <div><strong>[${data.productName}]</strong> ${data.qty}ê°œ (${Number(data.totalPrice).toLocaleString()}ì›)</div>
                            <div style="font-size:0.8rem; color:#666; margin-top:5px;">
                                ${data.userName} / ${data.userAddress}
                            </div>
                            ${data.status !== 'ë°°ì†¡ì™„ë£Œ' ? 
                                `<button class="btn btn-small" style="margin-top:5px;" onclick="updateOrderStatus('${data.id}')">ë°°ì†¡ì²˜ë¦¬</button>` : ''}
                        </div>
                    `;
                });
                listContainer.innerHTML = html;
                calculateStats();
            }, (error) => {
                console.error("ì£¼ë¬¸ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", error);
                document.getElementById('admin-order-list').innerHTML = `<div class="status-msg error-msg">ì£¼ë¬¸ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨<br>${error.message}</div>`;
            });
        }

        function calculateStats() {
            let totalRevenue = 0;
            let productCounts = {};
            let pendingCount = 0;
            let completedCount = 0;

            window.allOrders.forEach(order => {
                totalRevenue += (order.totalPrice || 0);
                if (order.status === 'ë°°ì†¡ì™„ë£Œ') completedCount++;
                else pendingCount++;

                const pName = order.productName || "ì•Œìˆ˜ì—†ìŒ";
                if (!productCounts[pName]) productCounts[pName] = 0;
                productCounts[pName] += (order.qty || 0);
            });

            document.getElementById('stat-total-revenue').innerText = totalRevenue.toLocaleString() + "ì›";
            document.getElementById('stat-total-count').innerText = window.allOrders.length + "ê±´";
            document.getElementById('stat-pending-count').innerText = pendingCount + "ê±´";
            document.getElementById('stat-completed-count').innerText = completedCount + "ê±´";

            const breakdownList = document.getElementById('stat-product-breakdown');
            breakdownList.innerHTML = "";
            for (const [name, count] of Object.entries(productCounts)) {
                const li = document.createElement('li');
                li.style.padding = "5px 0";
                li.style.borderBottom = "1px solid #eee";
                li.innerHTML = `<span>${name}</span> <span style="float:right; font-weight:bold;">${count}ê°œ</span>`;
                breakdownList.appendChild(li);
            }
        }

        // [ê¸°ëŠ¥ 4] ìƒí’ˆ ì¶”ê°€ ë° ìˆ˜ì • ì²˜ë¦¬ (ì—ëŸ¬ ìˆ˜ì •ë¨)
        document.getElementById('add-product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-prod-id').value; 
            
            // (í¼ ë°ì´í„° ìˆ˜ì§‘ ë¶€ë¶„ - ìƒëµ ì—†ì´ ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
            const name = document.getElementById('new-prod-name').value;
            const price = Number(document.getElementById('new-prod-price').value);
            const discount = Number(document.getElementById('new-prod-discount').value) || 0;
            const salePrice = document.getElementById('new-prod-sale-price').value ? Number(document.getElementById('new-prod-sale-price').value) : null;
            const category = document.getElementById('new-prod-category').value;
            
            // ìƒ‰ìƒë³„ ì¬ê³  ìˆ˜ì§‘
            const colorItems = document.querySelectorAll('.color-stock-item');
            const colorStocks = [];
            let totalStock = 0;
            
            colorItems.forEach(item => {
                const colorName = item.querySelector('.color-name-input').value.trim();
                const colorCode = item.querySelector('.color-picker-input').value;
                const stockS = parseInt(item.querySelector('.stock-s-input').value) || 0;
                const stockM = parseInt(item.querySelector('.stock-m-input').value) || 0;
                const stockL = parseInt(item.querySelector('.stock-l-input').value) || 0;
                
                if (colorName) {
                    colorStocks.push({
                        name: colorName, code: colorCode,
                        stock: { S: stockS, M: stockM, L: stockL },
                        total: stockS + stockM + stockL
                    });
                    totalStock += stockS + stockM + stockL;
                }
            });
            
            if (colorStocks.length === 0) { alert('ìµœì†Œ 1ê°œì˜ ìƒ‰ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            
            const img = document.getElementById('new-prod-img').value;
            const detailImgs = document.getElementById('new-prod-detail-imgs').value ? document.getElementById('new-prod-detail-imgs').value.split('\n').filter(u=>u.trim()) : [];
            const summary = document.getElementById('new-prod-summary').value;
            const description = document.getElementById('new-prod-description').value;
            const isBestseller = document.getElementById('new-prod-bestseller').checked;
            const isNew = document.getElementById('new-prod-new').checked;
            const tags = document.getElementById('new-prod-tags').value ? document.getElementById('new-prod-tags').value.split(',').map(t=>t.trim()) : [];
            
            const productData = {
                name, price, discount, salePrice, category, colorStocks, totalStock,
                img, detailImgs, summary, description, isBestseller, isNew, tags
            };

            try {
                if (id) {
                    // [ìˆ˜ì •ë¨] updateDoc ëŒ€ì‹  setDoc(merge: true) ì‚¬ìš©
                    await setDoc(doc(db, 'products', id), productData, { merge: true });
                    alert("ìƒí’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    window.cancelEdit(); 
                } else {
                    await addDoc(collection(db, 'products'), { ...productData, createdAt: serverTimestamp() });
                    alert("ìƒˆ ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    e.target.reset();
                    
                    // ìƒ‰ìƒ ì…ë ¥ì°½ ì´ˆê¸°í™”
                    const container = document.getElementById('color-stock-container');
                    const firstItem = container.querySelector('.color-stock-item');
                    if(firstItem) {
                        firstItem.querySelector('.color-name-input').value = '';
                        // ... ê¸°íƒ€ ì´ˆê¸°í™”
                    }
                    // ë‚˜ë¨¸ì§€ ìƒ‰ìƒí–‰ ì‚­ì œ
                    const items = container.querySelectorAll('.color-stock-item');
                    for(let i=1; i<items.length; i++) items[i].remove();
                    
                    window.updateAllStocks();
                }
            } catch (err) {
                console.error(err);
                alert("ì²˜ë¦¬ ì‹¤íŒ¨: " + err.message);
            }
        });

        // [ê¸°ëŠ¥ 5] ìƒí’ˆ ì‚­ì œ
        window.deleteProduct = async (id) => {
            if(!confirm("ì •ë§ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            try {
                await deleteDoc(doc(db, 'products', id));
            } catch(err) {
                console.error(err);
                alert("ì‚­ì œ ì‹¤íŒ¨: " + err.message);
            }
        };

        // [ê¸°ëŠ¥ 6] ì£¼ë¬¸ ì œì¶œ
        document.getElementById('order-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (window.cart.length === 0) { alert("ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."); return; }
            
            const btn = document.getElementById('btn-order-submit');
            btn.disabled = true; btn.innerText = "ì²˜ë¦¬ ì¤‘...";

            if (!currentUser) {
                alert("ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                btn.disabled = false; return;
            }

            const userName = document.getElementById('user-name').value;
            const userPhone = document.getElementById('user-phone').value;
            const userAddress = document.getElementById('user-address').value;
            const depositName = document.getElementById('deposit-name').value;

            try {
                const orderPromises = window.cart.map(item => {
                    const orderData = {
                        productName: item.name, option: item.option, qty: item.qty,
                        totalPrice: item.price * item.qty,
                        userName, userPhone, userAddress, depositName,
                        orderDate: serverTimestamp(), status: "ì…ê¸ˆëŒ€ê¸°"
                    };
                    return addDoc(collection(db, 'orders'), orderData);
                });

                await Promise.all(orderPromises);
                
                const totalAmount = window.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
                document.getElementById('final-price').innerText = totalAmount.toLocaleString();
                
                window.cart = [];
                window.updateCartUI();
                window.switchView('success-page');
                e.target.reset();
            } catch(err) { 
                console.error("ì£¼ë¬¸ ì˜¤ë¥˜:", err); alert("ì£¼ë¬¸ ì‹¤íŒ¨: " + err.message); 
            }
            finally { btn.disabled = false; btn.innerText = "ì£¼ë¬¸ ì™„ë£Œí•˜ê¸°"; }
        });

        window.updateOrderStatus = async (docId) => {
            if(!confirm("ë°°ì†¡ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            await updateDoc(doc(db, 'orders', docId), { status: "ë°°ì†¡ì™„ë£Œ" });
        };

        // [ê¸°ëŠ¥ 8] ì‚¬ì´íŠ¸ ì„¤ì • ë¡œë“œ ë° ì €ì¥
        async function loadSiteSettings() {
            try {
                const settingsDoc = await onSnapshot(doc(db, 'settings', 'site'), (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const headerText = data.headerText || 'ê¸°ë¡ ë‹¨ì¶•ì„ ìœ„í•œ ìµœê³ ì˜ ì„ íƒ';
                        const mainHeader = document.getElementById('main-header-text');
                        if (mainHeader) mainHeader.textContent = headerText;
                        const settingsInput = document.getElementById('site-header-text');
                        if (settingsInput) settingsInput.value = headerText;
                    }
                });
            } catch (err) { console.error("ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:", err); }
        }

        const settingsForm = document.getElementById('site-settings-form');
        if (settingsForm) {
            settingsForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const headerText = document.getElementById('site-header-text').value;
                try {
                    await setDoc(doc(db, 'settings', 'site'), {
                        headerText: headerText,
                        updatedAt: serverTimestamp()
                    });
                    alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (err) {
                    console.error("ì„¤ì • ì €ì¥ ì‹¤íŒ¨:", err);
                    alert('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + err.message);
                }
            });
        }
        
        // í—¤ë” ë¯¸ë¦¬ë³´ê¸°
        const headerInput = document.getElementById('site-header-text');
        const headerPreview = document.getElementById('header-preview');
        if (headerInput && headerPreview) {
            headerInput.addEventListener('input', function() {
                headerPreview.textContent = this.value || 'ê¸°ë¡ ë‹¨ì¶•ì„ ìœ„í•œ ìµœê³ ì˜ ì„ íƒ';
            });
        }
    </script>
</body>
</html>


